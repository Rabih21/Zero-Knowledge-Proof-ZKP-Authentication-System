<link rel="stylesheet" href="/static/style.css">
<div class="card">
<h2>ZKP Login</h2>
<input id="u" placeholder="Username">
<input id="p" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<pre id="log"></pre>
</div>

<script src="/static/crypto.js"></script>
<script>
async function login(){
  const s = await fetch("/login/start",{
    method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username:u.value})
  }).then(r=>r.json());

  const x = await hash(p.value + s.salt);
  const r = rand();
  const A = modPow(G, r, P);
  const e = await hash(A.toString() + s.challenge);
  const proof = (r + e * x) % (P-1n);

  const res = await fetch("/login/finish",{
    method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({A:A.toString(), s:proof.toString()})
  });

  log.innerText = JSON.stringify(await res.json(),null,2);
  then(d=>{
  if(d.redirect) window.location = d.redirect;
});

}
</script>
